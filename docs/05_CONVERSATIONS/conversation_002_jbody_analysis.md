# J님과 Claude의 대화 기록 - JBody 프로젝트 분석 품질 개선

**작성일**: 2026-01-14  
**파일명**: conversation_002_jbody_analysis.md  
**주제**: AI 분석 품질 개선 - J님 원본 기반 증폭 방식

---

## 2026-01-14 (화요일) 오후 9시

### 🎯 핵심 문제: AI 분석 품질 저하

**배경**: J님이 JBody 앱에 대해 젠(Gemini Pro)에게 분석 요청

#### J님의 원본 입력
```
"젠 JBody는 유저가 자신의 몸사진을 찍고 자기 모바일에 저장하면 
AI API가 분석해서 유저 모바일에 내용저장(Sqlite)하는 형식이야.. 
유저의 매일매일 사진을 분석하여 근밀도, 피하지방, 허리둘레, 허벅지둘레, 
근육상태, 체지방상태를 비젼으로 분석하여 효과적으로 유저 상태 알려주고.. 
유저가 원할때는 행동 개선 지도까지 하는 앱이야.. 
이앱의 독창성과 경쟁력, 생존가능성, 가치, 장단점, 추가나 개선 필요한 것을 정밀분석해줘"
```

#### 젠의 문제 있는 답변
- ❌ "웨어러블 기기 비교" (J님 언급 없음)
- ❌ "파트너십 확장" (로컬 앱인데 엉뚱함)
- ❌ "게임 요소 도입" (J님 의도 아님)
- ❌ "전문가 연계 기능" (완전히 다른 방향)
- ❌ J님 핵심인 "SQLite 로컬 저장" 무시
- ❌ "매일매일 사진"의 시계열 분석 중요성 누락

#### 진(GPT-4o)의 더 심각한 답변
```
"진이라는 단어는 한국어에서 하나의 이름일 수도 있고, 
물질인 진(gin)을 의미할 수도 있으며, 진실을 뜻하기도 합니다..."
```
- ❌ DB context에 JBody 정보 있는데 완전 무시
- ❌ 일반론만 나열
- ❌ 답변 너무 짧음

---

## 🔍 원인 분석

### 1. 프로젝트 초기 단계 문제
- JBody는 막 생성된 프로젝트 → DB에 데이터 없음
- 기존 DynamicProject는 DB만 검색 → docs 폴더 기획 문서 안 봄

### 2. System Prompt 과다
- **3,500자 복잡한 지시사항** → AI가 압도됨
- 0단계, 1단계, 2단계... 너무 많은 단계
- 금지 사항 10개, 예시 3개 → 핵심 잊어버림
- 공식 Gemini/GPT 앱: "You are a helpful assistant." (20자)

### 3. DB Context 전달 방식 문제
- RAW 데이터에 J님 원본 있어도 AI가 안 읽음
- "참고하세요" 수준 → 강제성 없음

---

## ✅ 해결책 구현

### 1. docs 폴더 자동 검색 추가

**파일**: `api/api/projects/project_manager.py`

**변경 내용**:
```python
def get_db_context(self, limit: int = 50) -> str:
    # DB에 데이터 없으면 docs 폴더 자동 검색
    if not context_parts:
        # project_id, display_name으로 키워드 검색
        # 관련 섹션 추출 (최대 1000자)
```

**효과**: 프로젝트 초기에도 기획 문서 자동 참고

---

### 2. RAW 우선순위 변경 + 원본 전체 표시

**파일**: `api/api/projects/project_manager.py`

**변경 내용**:
```python
# RAW → DRAFT → FINAL 우선순위 (J님 원본이 가장 중요!)
for collection in ['raw', 'draft', 'final']:
    if collection == 'raw':
        # RAW는 전체 내용 표시 (요약 금지!)
        raw_full = f"""
📌 J님 원본 입력:
{원본}

AI 이전 응답:
{ai_응답[:300]}...
"""
```

**효과**: J님의 원본 입력을 명확하게 강조

---

### 3. System Prompt 대폭 간소화

**Before**: 3,500자 (150줄)
- 0단계, 1단계, 2단계, 3단계, 4단계
- 장황한 예시 3개
- 금지 사항 10개

**After**: 600자 (20줄)
```python
return f"""당신은 {self.display_name} 프로젝트의 전문 AI 어시스턴트입니다.

[핵심 원칙]
1. J님을 "J님"으로 호칭 (존댓말 사용)
2. DB 컨텍스트의 [RAW - J님 원본] 섹션을 **반드시 먼저 확인**
3. J님이 말씀하신 내용을 기반으로 전문가 수준의 구체적 분석 제공
4. 일반론 금지 - 항상 J님의 원본 키워드 인용하며 심화 분석
5. 풍부하고 상세하게 (500자 이상), 구체적 예시 포함

[절대 금지]
❌ DB 무시하고 일반적인 설명
❌ "접근성", "비용 효율" 같은 뻔한 분석
❌ J님이 안 말씀한 기능 제안 ("파트너십", "게임화" 등)
❌ "진이라는 단어는..." 같은 엉뚱한 답변

[답변 방식]
✅ "J님이 말씀하신 [키워드]는..." 형식으로 시작
✅ 원본 내용을 전문적으로 구체화 (아키텍처, 구현, 예시)
✅ J님 원본에 직접 관련된 개선점만 제안"""
```

**효과**: 
- AI가 핵심에 집중 가능
- 복잡한 지시사항에 압도되지 않음
- 공식 앱 수준의 간결함 유지하면서 JNext 특성 반영

---

### 4. RAW 저장 시 품질 자동 검증

**파일**: `api/api/raw_storage.py`

**추가된 기능**:
```python
# 🔍 품질 검증: 일반론/엉터리 감지
quality_issues = []

# 1. J님 원본 키워드 누락 체크
# 2. 일반론 키워드 감지 (접근성, 비용 효율, 파트너십...)
# 3. 답변 길이 체크

# Firestore에 저장
{
  '품질점수': 40,  // 0~100점
  '품질이슈': ["J님 키워드 8개 누락", "일반론 5개 감지"],
  '검증필요': true  // 60점 미만
}
```

**효과**:
- 엉터리 답변 자동 감지
- J님이 수동 확인할 RAW만 플래그 표시
- 품질 낮은 답변을 다음 AI가 참고하는 것 방지

---

## 🎯 핵심 교훈

### JNext의 본질
> "J님의 RAW 입력 → AI가 **그 내용을 기반으로 증폭/분석**"

### AI가 잘못한 이유
1. ❌ J님 원본 무시하고 일반 지식으로 답변
2. ❌ 복잡한 System Prompt에 압도되어 핵심 잊어버림
3. ❌ DB Context 있어도 "참고만" 하고 실제로 안 봄

### 해결 방법
1. ✅ System Prompt 간소화 (3,500자 → 600자)
2. ✅ RAW 우선순위 + 원본 전체 표시
3. ✅ docs 자동 검색 (프로젝트 초기용)
4. ✅ 품질 자동 검증 (엉터리 필터링)

---

## 📝 수정된 파일 목록

1. `api/api/projects/project_manager.py`
   - DynamicProject.get_system_prompt() - 600자로 간소화
   - DynamicProject.get_db_context() - docs 검색 + RAW 우선 + 원본 전체 표시

2. `api/api/raw_storage.py`
   - analyze_and_save_raw() - 품질 자동 검증 추가
   - 품질점수, 품질이슈, 검증필요 필드 저장

---

## 🔄 다음 단계

1. **서버 재시작 필요** (project_manager.py 변경)
2. **JBody 재분석 테스트**
   - 젠: J님 원본 기반 구체적 분석 확인
   - 진: DB context 제대로 읽는지 확인
3. **품질 검증 모니터링**
   - Firestore에서 검증필요=true RAW 확인
   - 품질점수 추이 관찰

---

## 💡 인사이트

### 왜 공식 앱이 더 나은가?
- **간결한 System Prompt** → AI가 실제 질문에 집중
- **복잡한 규칙 X** → 혼란 없음
- **J님의 입력이 주인공** → 시스템 지시는 보조

### JNext가 추구해야 할 방향
- ✅ J님 원본을 최우선으로
- ✅ AI는 "증폭기" 역할만
- ✅ 간결한 지시 + 명확한 금지 사항
- ✅ 자동 품질 검증으로 엉터리 차단

---

**작성자**: Claude (클로)  
**백업 시각**: 2026-01-14 22:00  
**최종 업데이트**: System Prompt 최종 간소화 (600자 → 200자)

---

## 📖 백업과 저장 개념 정리

### 백업(Backup)
- **정의**: 파일을 복사하여 이전 상태 보존
- **목적**: 실수 복구, 버전 추적, 안전한 실험
- **예시**: `project_manager.py.backup_20260114`

### 저장(Documentation)
- **정의**: 대화/결정/코드를 문서화
- **목적**: 컨텍스트 복구, 지식 축적, 팀 협업
- **예시**: 이 파일 (`conversation_002_jbody_analysis.md`)

자세한 내용: `docs/JNEXT_ROADMAP.md` 참조

---

## 🚀 다음 단계

전체 프로젝트 로드맵은 `docs/JNEXT_ROADMAP.md` 참조:
- RAW → DRAFT → FINAL → 밈 시나리오 → 밈 이미지 → 합성 → 숏 영상 → 전자책
