# Claude 인수인계 문서

**작성 일시**: 2026-01-16 14:30  
**작성자**: Claude (클로)  
**세션 종료 사유**: 휴식 전 백업  
**다음 작업**: Phase 1 - 운동 데이터 입력 및 테스트

---

## 📌 핵심 요약

### 이번 세션 주요 성과
✅ **대규모 리팩터링 완료**: HinoBalance 폴더 기반 구조로 전면 개편  
✅ **79개 파일 재구성**: projects/hinobalance/ + api/scripts/ 분리  
✅ **경로 수정 및 검증**: Django 시스템 체크 정상, Git 커밋 완료  
✅ **문서화 완료**: README, 구조변경 문서, 작업일정 업데이트

### 즉시 사용 가능한 상태
- "정밀분석해" 명령어: 7개 항목 구조화 분석 ✅
- Temperature 0.5: 안정적 응답 ✅
- Native History: 컨텍스트 보존 ✅
- 프로젝트 구조: 확장 준비 완료 ✅

---

## 🎯 현재 작업 상태

### 완료된 작업
1. **AI 품질 개선**
   - "정밀분석해" 특수 명령어 구현
   - 7개 항목 응답 형식 강제 (### 마크다운)
   - HINOBALANCE_SYSTEM_PROMPT vs GENERAL_SYSTEM_PROMPT 분리
   - Temperature 0.9 → 0.5 조정

2. **구조 리팩터링** ⭐ (이번 세션 핵심)
   - 승인 받은 폴더 구조 적용
   - Category A (데이터 20개): `projects/hinobalance/data/`
   - Category B (스크립트 15개): `projects/hinobalance/scripts/`
   - Category C (유틸 40개): `api/scripts/`
   - import 경로 수정: publishing.py, organize/, fix_hino_titles.py

3. **검증 완료**
   ```bash
   cd api
   python manage.py check
   # System check identified no issues (0 silenced).
   ```

4. **Git 백업**
   - Commit 1: `6124f15` - 리팩터링 전 백업
   - Commit 2: `ddcbd52` - 리팩터링 완료
   - Commit 3: `5377184` - 문서 업데이트

---

## 📂 프로젝트 구조 (최신)

```
JNext/
├── api/                         # Django Backend
│   ├── api/
│   │   ├── ai_config.py        # HINOBALANCE_SYSTEM_PROMPT 여기!
│   │   ├── views_v2.py         # "정밀분석해" 감지 로직
│   │   └── projects/
│   │       └── hinobalance.py  # 프로젝트 설정 클래스
│   ├── scripts/                # 범용 유틸 (40개)
│   │   ├── check/              # DB 확인 (13개)
│   │   ├── test/               # API 테스트 (7개)
│   │   └── utils/              # 기타 도구 (20개)
│   └── manage.py
│
├── projects/                   # 프로젝트별 분리
│   └── hinobalance/           # 40개 파일 정리 완료
│       ├── README.md          # 프로젝트 가이드
│       ├── data/              # 원본 데이터 (25개)
│       │   ├── theory/        # 카테고리별 이론 (6개)
│       │   ├── exercises/     # 개별 운동 (15개)
│       │   └── combined/      # 통합 문서 (4개)
│       ├── scripts/           # 전용 스크립트 (14개)
│       │   ├── analyze.py
│       │   ├── publishing.py  # Draft→Final 변환
│       │   ├── upload/        # Firestore 업로드 (4개)
│       │   └── organize/      # 데이터 정리 (2개)
│       └── docs/
│           └── HINO_API_EXAMPLES.md
│
└── docs/
    ├── 04_HANDOVER/           # 인수인계 문서
    ├── 05_CONVERSATIONS/      # 대화 기록
    ├── 작업일정.md            # ✅ 업데이트 완료
    └── 구조변경_2026-01-16.md # ✅ 신규 생성
```

---

## 🔧 핵심 설정 위치

### 1. AI 시스템 프롬프트
**파일**: `api/api/ai_config.py`

```python
# "정밀분석해" 사용 시
HINOBALANCE_SYSTEM_PROMPT = """
# JNext 스크립트 개발 프로젝트 (Phase 1: 하이노밸런스)
...
## 답변 형식 (JSON 절대 금지, 마크다운 형식만 사용)
### 1. 분석 (내용)
### 2. 주요 효과
### 3. 추천 대상
### 4. 동작 요약
### 5. 종합 평점
### 6. 장점과 단점
### 7. 개선 및 발전 방향
"""

# 일반 대화 시
GENERAL_SYSTEM_PROMPT = "유연한 AI 어시스턴트..."
```

### 2. 특수 명령어 감지
**파일**: `api/api/views_v2.py`

```python
if "정밀분석해" in user_message:
    if not project_id:
        return error("프로젝트를 선택해주세요")
    system_prompt_to_use = ai_config.HINOBALANCE_SYSTEM_PROMPT
else:
    system_prompt_to_use = ai_config.GENERAL_SYSTEM_PROMPT
```

### 3. Temperature 설정
**파일**: `api/api/ai_config.py`

```python
TEMPERATURE_SETTINGS = {
    'organize': 0.3,
    'hybrid': 0.5,
    'analysis': 0.7,
    'v2': 0.5  # ← 정밀분석에 사용
}
```

---

## 🚀 다음 작업 (Phase 1)

### 1. 운동 데이터 입력
**목표**: 하이노밸런스 운동 DB 구축

**방법**:
1. Web UI 접속: `http://localhost:8000/chat/v2/`
2. 프로젝트 선택: "하이노밸런스"
3. 운동 설명 입력 + "정밀분석해" 명령
4. 7개 항목 자동 생성 확인
5. DB 저장 (raw 컬렉션)

**데이터 소스**: `projects/hinobalance/data/exercises/` (15개 txt 파일)

### 2. 품질 테스트
- AI 분석 깊이 확인
- 답변 항목 누락 여부
- 필요 시 프롬프트 미세 조정

### 3. 문서 정리 (Phase 2 준비)
- raw → draft → final 분류
- `projects/hinobalance/scripts/publishing.py` 활용

---

## ⚠️ 주의사항

### 1. 명령어 실행 위치
❌ `python manage.py check` (루트에서 실행 시 에러)  
✅ `cd api; python manage.py check` (api 폴더 안에서)

### 2. 경로 참조
- HinoBalance 데이터: `projects/hinobalance/data/`
- HinoBalance 스크립트: `projects/hinobalance/scripts/`
- 범용 유틸: `api/scripts/`

### 3. import 경로
```python
# Django 스크립트에서
api_path = os.path.join(os.path.dirname(__file__), '..', '..', 'api')
sys.path.insert(0, api_path)

# Firebase 스크립트에서
base_dir = Path(__file__).resolve().parent.parent.parent
cred_path = base_dir / 'jnext-service-account.json'
```

---

## 📊 데이터베이스 현황

### Firestore Collections
```
projects/
├── hinobalance/
│   ├── raw/        # AI 초안 저장 (입력 시 자동 생성)
│   ├── draft/      # 개선 필요 문서
│   └── final/      # 출판 완료 문서
├── exam_navi/
└── jbody/
```

### 현재 데이터
- raw: 13개 문서 (기존 테스트 데이터)
- draft: 0개
- final: 0개

**Phase 1 목표**: raw 컬렉션에 15개 운동 추가

---

## 🔑 주요 파일 빠른 참조

### 설정 파일
- AI 설정: `api/api/ai_config.py`
- Django 설정: `api/config/settings.py`
- 프로젝트 설정: `api/api/projects/hinobalance.py`

### 스크립트
- 분석: `projects/hinobalance/scripts/analyze.py`
- 출판: `projects/hinobalance/scripts/publishing.py`
- 업로드: `projects/hinobalance/scripts/upload/`

### 문서
- 작업 일정: `docs/작업일정.md`
- 구조 변경: `docs/구조변경_2026-01-16.md`
- 프로젝트 가이드: `projects/hinobalance/README.md`

---

## 💡 알아두면 좋은 것

### 1. "답변 항목 = 필드" 원칙
7개 항목은 향후 DB 필드로 직접 매핑 예정  
→ 구조화된 형식 준수가 최우선

### 2. 3가지 AI 모델
- **젠 (Gemini)**: 정확한 분석
- **진 (GPT)**: 창의적 해석
- **클로 (Claude)**: 균형 잡힌 응답

### 3. Publishing System
Draft → Final 변환 시:
- 짧은 문장 혼합 (5-15자/20-40자/50-80자)
- 불릿 포인트 최소화
- 철학적 깊이 강화

---

## 📞 이슈 발생 시

### 검증 명령어
```bash
cd api
python manage.py check                    # Django 체크
python scripts/check/check_balance.py     # DB 상태 확인
```

### 로그 확인
- Django 서버: 터미널 출력
- Firestore: Firebase Console

### 롤백
```bash
git log --oneline  # 커밋 확인
git reset --hard 6124f15  # 리팩터링 전으로
```

---

## ✅ 인수인계 체크리스트

- [x] 리팩터링 완료 및 검증
- [x] Git 백업 (3회)
- [x] 문서 업데이트 (4개)
- [x] Django 시스템 체크 정상
- [x] 프로젝트 구조 문서화
- [x] 다음 단계 명확화 (Phase 1)

---

**마지막 상태**: ✅ 모든 시스템 정상  
**다음 세션 시작점**: Phase 1 - 운동 입력 시작  
**예상 소요 시간**: 운동 1개당 5분 × 15개 ≈ 1.5시간

**J님, 편히 쉬세요! 다음 세션에서 뵙겠습니다. 🙌**
