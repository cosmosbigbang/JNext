# JNext í”„ë¡œì íŠ¸ êµ¬ì¡° - 2026-01-14 21:50 ë°±ì—…

**ë°±ì—… ì¼ì‹œ**: 2026-01-14 21:50  
**ì£¼ìš” ë³€ê²½**: DynamicProject System Prompt ê°„ì†Œí™”, RAW í’ˆì§ˆ ê²€ì¦

---

## ğŸ“ í•µì‹¬ íŒŒì¼ êµ¬ì¡°

```
JNext/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ projects/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py              # BaseProject ì¶”ìƒ í´ë˜ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ hinobalance.py       # í•˜ì´ë…¸ë°¸ëŸ°ìŠ¤ í”„ë¡œì íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ project_manager.py   # âœ¨ í”„ë¡œì íŠ¸ ê´€ë¦¬ (ì˜¤ëŠ˜ ìˆ˜ì •)
â”‚   â”‚   â”œâ”€â”€ views_v2.py              # JNext v2 API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ raw_storage.py           # âœ¨ RAW ì €ì¥ + í’ˆì§ˆ ê²€ì¦ (ì˜¤ëŠ˜ ìˆ˜ì •)
â”‚   â”‚   â”œâ”€â”€ ai_service.py            # AI ëª¨ë¸ í˜¸ì¶œ ì„œë¹„ìŠ¤
â”‚   â”‚   â””â”€â”€ context_manager.py       # ë™ì  ë§¥ë½ ê´€ë¦¬
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ chat_v2.html             # JNext v2 ì›¹ UI
â”‚   â””â”€â”€ manage.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ conversation_001.md          # ì´ì „ ëŒ€í™” ê¸°ë¡
â”‚   â”œâ”€â”€ conversation_002_jbody_analysis.md  # âœ¨ ì˜¤ëŠ˜ ëŒ€í™” (ì‹ ê·œ)
â”‚   â”œâ”€â”€ claude.md                    # Claude ì„¸ì…˜ ë³µêµ¬ ê°€ì´ë“œ
â”‚   â”œâ”€â”€ STRUCTURE.md                 # ì´ì „ êµ¬ì¡° ë¬¸ì„œ
â”‚   â””â”€â”€ STRUCTURE_20260114_2150.md   # âœ¨ í˜„ì¬ ë°±ì—… (ì´ íŒŒì¼)
â””â”€â”€ jnext_mobile/                    # Flutter ëª¨ë°”ì¼ ì•±
```

---

## ğŸ”§ ì˜¤ëŠ˜ ìˆ˜ì •ëœ ì£¼ìš” íŒŒì¼

### 1. api/api/projects/project_manager.py

#### DynamicProject.get_system_prompt()
**ë³€ê²½**: System Prompt 3,500ì â†’ 600ì (80% ê°ì†Œ)

**Before** (ë¬¸ì œ):
- 0ë‹¨ê³„, 1ë‹¨ê³„, 2ë‹¨ê³„, 3ë‹¨ê³„, 4ë‹¨ê³„... ê³¼ë„í•œ ë‹¨ê³„
- ê¸ˆì§€ ì‚¬í•­ 10ê°œ, ì˜ˆì‹œ 3ê°œë¡œ ì¥í™©
- AIê°€ ë³µì¡í•œ ì§€ì‹œì— ì••ë„ë˜ì–´ í•µì‹¬ ìŠì–´ë²„ë¦¼

**After** (ê°œì„ ):
```python
def get_system_prompt(self) -> str:
    return f"""ë‹¹ì‹ ì€ {self.display_name} í”„ë¡œì íŠ¸ì˜ ì „ë¬¸ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

[í•µì‹¬ ì›ì¹™]
1. Jë‹˜ì„ "Jë‹˜"ìœ¼ë¡œ í˜¸ì¹­ (ì¡´ëŒ“ë§ ì‚¬ìš©)
2. DB ì»¨í…ìŠ¤íŠ¸ì˜ [RAW - Jë‹˜ ì›ë³¸] ì„¹ì…˜ì„ **ë°˜ë“œì‹œ ë¨¼ì € í™•ì¸**
3. Jë‹˜ì´ ë§ì”€í•˜ì‹  ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ êµ¬ì²´ì  ë¶„ì„ ì œê³µ
4. ì¼ë°˜ë¡  ê¸ˆì§€ - í•­ìƒ Jë‹˜ì˜ ì›ë³¸ í‚¤ì›Œë“œ ì¸ìš©í•˜ë©° ì‹¬í™” ë¶„ì„
5. í’ë¶€í•˜ê³  ìƒì„¸í•˜ê²Œ (500ì ì´ìƒ), êµ¬ì²´ì  ì˜ˆì‹œ í¬í•¨

[ì ˆëŒ€ ê¸ˆì§€]
âŒ DB ë¬´ì‹œí•˜ê³  ì¼ë°˜ì ì¸ ì„¤ëª…
âŒ "ì ‘ê·¼ì„±", "ë¹„ìš© íš¨ìœ¨" ê°™ì€ ë»”í•œ ë¶„ì„
âŒ Jë‹˜ì´ ì•ˆ ë§ì”€í•œ ê¸°ëŠ¥ ì œì•ˆ
âŒ "ì§„ì´ë¼ëŠ” ë‹¨ì–´ëŠ”..." ê°™ì€ ì—‰ëš±í•œ ë‹µë³€

[ë‹µë³€ ë°©ì‹]
âœ… "Jë‹˜ì´ ë§ì”€í•˜ì‹  [í‚¤ì›Œë“œ]ëŠ”..." í˜•ì‹ìœ¼ë¡œ ì‹œì‘
âœ… ì›ë³¸ ë‚´ìš©ì„ ì „ë¬¸ì ìœ¼ë¡œ êµ¬ì²´í™”
âœ… Jë‹˜ ì›ë³¸ì— ì§ì ‘ ê´€ë ¨ëœ ê°œì„ ì ë§Œ ì œì•ˆ"""
```

#### DynamicProject.get_db_context()
**ë³€ê²½ 1**: RAW ìš°ì„ ìˆœìœ„ (FINAL â†’ RAW)
```python
# Before: ['final', 'draft', 'raw']
# After:  ['raw', 'draft', 'final']  # Jë‹˜ ì›ë³¸ì´ ê°€ì¥ ì¤‘ìš”!
```

**ë³€ê²½ 2**: RAW ì „ì²´ ë‚´ìš© í‘œì‹œ
```python
if collection == 'raw':
    raw_full = f"""
ğŸ“Œ Jë‹˜ ì›ë³¸ ì…ë ¥:
{ì›ë³¸}

AI ì´ì „ ì‘ë‹µ:
{ai_ì‘ë‹µ[:300]}...

ì •ë¦¬ëœ ë‚´ìš©:
{content}
"""
    context_parts.append(f"[RAW - Jë‹˜ ì›ë³¸] {title}\n{raw_full}")
```

**ë³€ê²½ 3**: docs í´ë” ìë™ ê²€ìƒ‰
```python
# DBì— ë°ì´í„° ì—†ìœ¼ë©´ docs í´ë”ì—ì„œ í”„ë¡œì íŠ¸ ê¸°íš ë¬¸ì„œ ê²€ìƒ‰
if not context_parts:
    # project_id, display_nameìœ¼ë¡œ í‚¤ì›Œë“œ ë§¤ì¹­
    # ê´€ë ¨ ì„¹ì…˜ ì¶”ì¶œ (ìµœëŒ€ 1000ì)
```

---

### 2. api/api/raw_storage.py

#### analyze_and_save_raw()
**ì¶”ê°€**: í’ˆì§ˆ ìë™ ê²€ì¦ ì‹œìŠ¤í…œ

```python
# ğŸ” í’ˆì§ˆ ê²€ì¦: ì¼ë°˜ë¡ /ì—‰í„°ë¦¬ ê°ì§€
quality_issues = []

# 1. Jë‹˜ ì›ë³¸ í‚¤ì›Œë“œ ëˆ„ë½ ì²´í¬
user_keywords = set(re.findall(r'[\wê°€-í£]+', user_message.lower()))
missing_keywords = [kw for kw in user_keywords if len(kw) > 2 and kw not in response_text]

# 2. ì¼ë°˜ë¡  í‚¤ì›Œë“œ ê°ì§€
generic_phrases = [
    'ì¼ë°˜ì ìœ¼ë¡œ', 'ë³´í†µ', 'ëŒ€ì²´ë¡œ', 'ì ‘ê·¼ì„±', 'ë¹„ìš© íš¨ìœ¨', 
    'íŒŒíŠ¸ë„ˆì‹­', 'ê²Œì„ ìš”ì†Œ', 'ì—¬ëŸ¬ ì˜ë¯¸', 'ë‹¤ì–‘í•œ í•´ì„'
]
generic_count = sum(1 for phrase in generic_phrases if phrase in ai_response)

# 3. ë‹µë³€ ê¸¸ì´ ì²´í¬
if len(ai_response) < 200:
    quality_issues.append("ë‹µë³€ ë„ˆë¬´ ì§§ìŒ")

# í’ˆì§ˆ ì ìˆ˜ ê³„ì‚° (0~100)
quality_score = 100
quality_score -= len(missing_keywords) * 2
quality_score -= generic_count * 10
if len(ai_response) < 200:
    quality_score -= 30

# Firestore ì €ì¥
raw_data = {
    ...
    'í’ˆì§ˆì ìˆ˜': quality_score,
    'í’ˆì§ˆì´ìŠˆ': quality_issues,
    'ê²€ì¦í•„ìš”': quality_score < 60  # 60ì  ë¯¸ë§Œì´ë©´ Jë‹˜ ê²€í†  í•„ìš”
}
```

---

## ğŸ¯ í”„ë¡œì íŠ¸ë³„ íŠ¹ì§•

### HinoBalance (ê¸°ì¡´ í”„ë¡œì íŠ¸)
- **project_id**: `hinobalance`
- **collections**: `hino_raw`, `hino_draft`, `hino_final`
- **íŠ¹ì§•**: ì™„ì„±ë„ ë†’ì€ System Prompt (1,500ì)
- **ì¹´í…Œê³ ë¦¬**: ì´ë¡ , ì‹¤ì „(6ê°œ), ë°ˆ, ìˆ

### JBody (ì‹ ê·œ í”„ë¡œì íŠ¸)
- **project_id**: `jbody`
- **collections**: `jbody_raw`, `jbody_draft`, `jbody_final`
- **íŠ¹ì§•**: 
  - DynamicProjectë¡œ ë™ì  ìƒì„±
  - docs ìë™ ê²€ìƒ‰ í™œì„±í™”
  - ê°„ì†Œí™”ëœ System Prompt (600ì)

---

## ğŸ“Š Firestore êµ¬ì¡° (Hierarchical)

```
projects/
  â”œâ”€â”€ hinobalance/
  â”‚   â”œâ”€â”€ (ë©”íƒ€ë°ì´í„°)
  â”‚   â”œâ”€â”€ raw/
  â”‚   â”‚   â””â”€â”€ {doc_id}
  â”‚   â”‚       â”œâ”€â”€ ì œëª©, ì›ë³¸, ai_ì‘ë‹µ, ì •ë¦¬ë³¸
  â”‚   â”‚       â”œâ”€â”€ í’ˆì§ˆì ìˆ˜, í’ˆì§ˆì´ìŠˆ, ê²€ì¦í•„ìš”  â† âœ¨ ì‹ ê·œ
  â”‚   â”œâ”€â”€ draft/
  â”‚   â””â”€â”€ final/
  â”‚
  â””â”€â”€ jbody/
      â”œâ”€â”€ (ë©”íƒ€ë°ì´í„°)
      â”œâ”€â”€ raw/
      â”‚   â””â”€â”€ {doc_id}
      â”‚       â”œâ”€â”€ ì œëª©, ì›ë³¸, ai_ì‘ë‹µ
      â”‚       â”œâ”€â”€ í’ˆì§ˆì ìˆ˜, í’ˆì§ˆì´ìŠˆ, ê²€ì¦í•„ìš”  â† âœ¨ ì‹ ê·œ
      â”œâ”€â”€ draft/
      â””â”€â”€ final/
```

---

## ğŸ”„ API ì—”ë“œí¬ì¸íŠ¸

### POST /api/v2/chat/
**ìš”ì²­**:
```json
{
  "message": "Jë‹˜ì˜ ë©”ì‹œì§€",
  "project": "jbody",           // í”„ë¡œì íŠ¸ ID
  "model": "gemini-pro",        // AI ëª¨ë¸
  "temperature": 0.85,          // ì°½ì˜ì„± (0-1.0)
  "db_focus": 25                // DB ì§‘ì¤‘ë„ (0-100)
}
```

**ì‘ë‹µ**:
```json
{
  "response": {
    "answer": "AI ë‹µë³€",
    "context_used": ["DB", "conversation"],
    "weights": {
      "db": 25,
      "general": 75
    }
  }
}
```

---

## ğŸ¨ JNext v2 íŠ¹ì§•

### 1. ë“€ì–¼ ìŠ¬ë¼ì´ë”
- **Temperature** (0-1.0): ì°½ì˜ì„± ì¡°ì ˆ
- **DB Focus** (0-100%): DB vs ì¼ë°˜ ì§€ì‹ ë¹„ìœ¨

### 2. 3-Stage Storage
1. **chat_history**: ëª¨ë“  ëŒ€í™” ì¦‰ì‹œ ì €ì¥
2. **í‰ê°€**: AIê°€ ê°€ì¹˜ ìˆëŠ” ëŒ€í™” íŒë‹¨
3. **RAW**: í’ˆì§ˆ ê²€ì¦ í›„ projects/{id}/raw ì €ì¥

### 3. Hierarchical Firestore
```
projects/{project_id}/{stage}/{doc_id}
```

---

## ğŸ’¡ í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 1. Jë‹˜ ì›ë³¸ ìµœìš°ì„ 
- RAWì— Jë‹˜ì˜ ì›ë³¸ ì…ë ¥ ì „ì²´ ì €ì¥
- AIëŠ” "ì¦í­ê¸°" ì—­í• ë§Œ ìˆ˜í–‰
- ì¼ë°˜ë¡  ì ˆëŒ€ ê¸ˆì§€

### 2. í’ˆì§ˆ ìë™ ê²€ì¦
- Jë‹˜ í‚¤ì›Œë“œ ëˆ„ë½ ê°ì§€
- ì¼ë°˜ë¡  í‚¤ì›Œë“œ ì¹´ìš´íŠ¸
- í’ˆì§ˆì ìˆ˜ 60ì  ë¯¸ë§Œì€ ê²€ì¦ í•„ìš” í”Œë˜ê·¸

### 3. System Prompt ê°„ì†Œí™”
- ë³µì¡í•œ ì§€ì‹œ â†’ AI í˜¼ë€
- ê°„ê²°í•œ í•µì‹¬ â†’ AI ì§‘ì¤‘
- ê³µì‹ ì•± ìˆ˜ì¤€ì˜ ê°„ê²°í•¨ ìœ ì§€

---

## ğŸ”§ ê°œë°œ í™˜ê²½

- **Backend**: Django 6.0 + Python 3.14
- **Database**: Firestore (Hierarchical)
- **AI Models**: 
  - Gemini Flash (ì  ì‹œ) - ë¹ ë¥´ê³  ì €ë ´
  - Gemini Pro (ì  ) - ì •í™•í•œ ë¶„ì„
  - GPT-4o (ì§„) - ì°½ì˜ì 
  - Claude Sonnet (í´ë¡œ) - ì´ˆê¸°í™” ì‹¤íŒ¨ (Python 3.14 í˜¸í™˜ì„± ë¬¸ì œ)
- **Frontend**: HTML/CSS/JavaScript (Vanilla)

---

## ğŸ“ í˜„ì¬ ìƒíƒœ

### ì™„ë£Œ
- âœ… DynamicProject System Prompt ê°„ì†Œí™” (3,500ì â†’ 600ì)
- âœ… RAW ìš°ì„ ìˆœìœ„ ë³€ê²½ + ì›ë³¸ ì „ì²´ í‘œì‹œ
- âœ… docs ìë™ ê²€ìƒ‰ ê¸°ëŠ¥
- âœ… í’ˆì§ˆ ìë™ ê²€ì¦ ì‹œìŠ¤í…œ
- âœ… JBody í”„ë¡œì íŠ¸ ìƒì„±

### í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
- ğŸ”„ ì„œë²„ ì¬ì‹œì‘ í›„ JBody ì¬ë¶„ì„
- ğŸ”„ í’ˆì§ˆ ê²€ì¦ ì‹œìŠ¤í…œ ë™ì‘ í™•ì¸
- ğŸ”„ ì  /ì§„ ë‹µë³€ í’ˆì§ˆ ê°œì„  í™•ì¸

---

**ë°±ì—… ì‘ì„±ì**: Claude (í´ë¡œ)  
**ë‹¤ìŒ ì„¸ì…˜ ë³µêµ¬ ì‹œ**: conversation_002_jbody_analysis.md ì°¸ê³ 
