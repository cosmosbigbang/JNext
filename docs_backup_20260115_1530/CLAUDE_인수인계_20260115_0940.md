# Claude 인수인계 문서
**작성일시**: 2026-01-15 09:40  
**이전 세션**: 06:53 ~ 09:33 (2시간 40분)  
**Git 상태**: commit a459af3, push 완료  
**서버**: 실행 중 (python manage.py runserver)

---

## 🎯 현재 상태 요약

### ✅ 완성된 기능
1. **전자책 출판 시스템**
   - 폰트: Noto Serif KR (본문 16px), Noto Sans KR (제목 18-24px)
   - 줄간격 2.0, 여백 40px, word-break: keep-all
   - 파일: `api/templates/document_manager.html`

2. **AI 이미지 생성 시스템**
   - DALL-E 3 연동 (OpenAI API)
   - 비용: $0.04/장
   - 9가지 크기 옵션: 1024/512/256 × 정사각/가로/세로
   - API: `POST /api/v2/images/generate/`
   - 파일: `api/api/views_v2.py` - generate_image()

3. **Firebase Storage 연동**
   - 버킷: jnext-e3dd9.firebasestorage.app
   - 자동 업로드 + 공개 URL 반환
   - 이미지 메타데이터 Firestore 저장

4. **반응형 레이아웃**
   - 대형(1024px): 중앙 정렬, display: block
   - 중형(512px): float left, margin-right
   - 소형(256px): float right, margin-left
   - 자동 마크다운 변환: convertMarkdownImagesToHtml()

5. **캐릭터 스타일 분석 (캐싱)**
   - Gemini Vision으로 기존 이미지 스타일 분석
   - 메모리 캐싱: generate_image._style_cache
   - 최초 1회만 호출 → 비용 절감

### ⏸️ 보류된 작업
- **밈 이미지 자동 생성**: DALL-E의 캐릭터 일관성 한계로 보류
  - 대안: `meme_images/` 폴더의 기존 이미지 재사용
  - 3인 시트콤 (J, 아내, 지피) 조합
  - 별도 세션에서 재논의

---

## 📋 다음 작업 (우선순위)

### 1단계: 이론 설명 이미지 생성 (최우선)
**목표**: 하이노밸런스 이론 설명을 위한 다이어그램/일러스트 생성

**방법**:
```
1. J님과 함께 프롬프트 작성
   예: "하이노밸런스 이론의 3가지 핵심 원리를 보여주는 인포그래픽"
   
2. document_manager.html에서 이미지 생성 버튼 사용
   - 크기: 중형(512px) 또는 소형(256px) 추천
   - 레이아웃: float로 텍스트 옆 자연스럽게 배치
   
3. 생성된 이미지 문서에 삽입
   - 자동으로 Firebase Storage 업로드
   - Firestore에 메타데이터 저장
```

**필요 이미지**:
- 하이노밸런스 3대 원리 다이어그램
- 6개 카테고리 개념도
- 18개 동작 분류표
- 기타 J님이 요청하는 설명 이미지

### 2단계: RAW → FINAL 대량 이동
**목표**: 하이노밸런스 18개 동작 문서를 FINAL로 이동

**현황**:
- 총 18개 동작 중 15개 처리 완료 (이전 세션)
- 3개 신규 생성 필요:
  1. 하이노워밍기본
  2. 하이노철봉두손
  3. 유머밈 (3-4개 선정)

**작업 방법**:
```javascript
// document_manager.html의 기존 함수 활용
moveToFinal(docId)  // 90% - RAW → FINAL 직행
moveToDraft(docId)  // 10% - RAW → DRAFT 경유
```

**주의사항**:
- FINAL 이동 시 Firestore에서 `최종완성일`, `완성상태: "FINAL"` 자동 기록
- 검색 인덱스 자동 업데이트 (search_v2.py)

### 3단계: 전자책 조립
**목표**: 하이노밸런스 전자책 초안 완성

**구성**:
1. 서사 (J님의 여정)
2. 이론 (3대 원리, 6개 카테고리)
3. 18개 동작 상세 설명 + 이미지
4. 유머 밈 3-4개 (기존 이미지 재사용)

**서식**:
- Noto Serif KR 폰트 (본문)
- Noto Sans KR 폰트 (제목)
- 이미지는 크기별 자동 레이아웃
- 줄간격 2.0으로 가독성 확보

---

## 🔧 기술 정보

### API 엔드포인트
```
POST /api/v2/images/generate/
Body: {
    "project_id": "하이노밸런스",
    "doc_id": "문서ID",
    "prompt": "이미지 설명",
    "size": "1024x1024" | "1024x1792" | "1792x1024" | ... (9가지)
}
Response: {
    "image_url": "https://storage.googleapis.com/...",
    "success": true
}
```

### Firebase 설정
- **서비스 계정**: `jnext-service-account.json`
- **Storage 버킷**: jnext-e3dd9.firebasestorage.app
- **Firestore 컬렉션**: 
  - `projects/{project_id}/documents/{doc_id}`
  - 이미지 목록: `이미지목록` 필드에 배열로 저장

### 환경변수 (필요 시 확인)
```python
# api/config/settings.py 또는 환경변수
OPENAI_API_KEY = os.getenv('OPENAI_API_KEY')
GOOGLE_APPLICATION_CREDENTIALS = 'jnext-service-account.json'
```

### 주요 파일 위치
```
api/
  templates/document_manager.html  # 프론트엔드 UI
  api/views_v2.py                  # 이미지 생성 API
  config/urls.py                   # URL 라우팅
  
meme_images/                       # 기존 밈 이미지 (재사용)
docs/
  CLAUDE_작업진행서_20260115_0933.md  # 이전 작업 기록
  IMAGE_AND_EBOOK_PLAN.md             # 현재 열려있는 파일
```

---

## ⚠️ 주의사항

### DALL-E 비용 관리
- 1장당 $0.04
- 50장 생성 시 약 $2
- J님 승인 없이 대량 생성 금지

### 캐릭터 일관성 문제
- **DALL-E는 기존 캐릭터 재현 불가**
- 밈 이미지는 `meme_images/` 폴더 재사용
- 이론 설명 이미지만 DALL-E 사용

### Gemini Vision 캐싱
- 첫 호출 시에만 스타일 분석
- `generate_image._style_cache`에 저장
- 동일 이미지 재사용 시 비용 0

### Firebase Storage
- 이미지는 자동으로 public URL 생성
- 삭제 시 Storage와 Firestore 모두 정리 필요

---

## 🚀 빠른 시작 (다음 Claude를 위한)

### 1. 서버 확인
```powershell
# 이미 실행 중이어야 함
cd C:\Projects\JNext\api
python manage.py runserver
```

### 2. 문서 관리자 접속
```
http://localhost:8000/document-manager/
```

### 3. 하이노밸런스 프로젝트 선택
```
프로젝트 목록에서 "하이노밸런스" 클릭
→ RAW, DRAFT, FINAL 문서 목록 확인
```

### 4. 이미지 생성 테스트
```
1. FINAL 문서 하나 선택
2. "이미지 생성" 버튼 클릭
3. 프롬프트 입력: "테스트 이미지"
4. 크기: 512x512
5. 생성 후 문서에 자동 삽입 확인
```

### 5. J님과 협업
```
J님이 원하는 이론 설명 이미지 프롬프트 확인
→ 함께 프롬프트 다듬기
→ 생성 & 삽입
→ 만족할 때까지 반복
```

---

## 💬 J님 피드백 (중요)

### J님 만족 포인트
- ✅ "클로 폰트 마음에 들어 ㅎㅎㅎ" → Noto 폰트 성공
- ✅ "클로 대단해 넘 잘만들었다" → 이미지 시스템 성공
- ✅ "진, 젠, 너 중 클로가 제일 믿음직해" → 신뢰 관계

### J님 작업 스타일
- 빠른 피드백 선호
- 실용적 타협 (밈 이미지 보류 결정)
- 백업 중요시 ("백업과 저장은 생명선")
- 문서화 선호 (작업진행서 요청)

### 소통 패턴
- 가볍고 친근한 톤 ("ㅎㅎㅎ" 자주 사용)
- 직관적 설명 선호
- 코드보다 결과 중심
- 잡담 환영 (휴식 필요 시)

---

## 📊 현재 프로젝트 상태

### Firestore 컬렉션 구조
```
projects/
  하이노밸런스/
    documents/
      하이노골반돌리기/         (상태: FINAL)
      하이노골반벌리기/         (상태: FINAL)
      ...
      하이노워밍기본/           (생성 필요)
      하이노철봉두손/           (생성 필요)
```

### Git 상태
```
Commit: a459af3
Message: "전자책 출판 시스템 완성: Noto 폰트, DALL-E 이미지 생성, Firebase Storage 연동, 크기별 레이아웃"
Files: 23 changed, 3,072 insertions(+), 49 deletions(-)
Branch: main
Remote: https://github.com/cosmosbigbang/JNext.git
```

---

## 🎓 배운 교훈

1. **DALL-E 한계**: 기존 캐릭터 일관성 유지 불가 → 범용 이미지만 생성
2. **캐싱 전략**: Gemini Vision을 메모리 캐싱으로 비용 절감
3. **레이아웃 전략**: 크기별 자동 float로 편집자 부담 감소
4. **API 전환**: Imagen 404 → DALL-E로 빠른 전환 성공
5. **백업 우선**: J님 요청 시 즉시 Git commit & push

---

## 🔮 미래 작업 (나중에)

### 개선 아이디어
- [ ] 이미지 일괄 삭제 기능
- [ ] 이미지 크기 조정 (업로드 후)
- [ ] 프롬프트 히스토리 저장
- [ ] 이미지 검색/필터링
- [ ] 비용 트래킹 대시보드

### 보류 중인 밈 시스템
- DALL-E 대신 Stable Diffusion LoRA 학습 검토
- 또는 수동 제작 후 재사용
- 3인 시트콤 캐릭터 일관성 필수

---

## ✋ 종료 전 체크리스트

다음 세션 시작 전:
- [ ] 서버 실행 중인지 확인
- [ ] Git 최신 상태인지 확인 (git pull)
- [ ] Firebase 연결 정상인지 테스트
- [ ] J님 요청사항 명확히 파악
- [ ] 토큰 상태 여유 있는지 확인

---

**작성자**: Claude (이전 세션)  
**다음 Claude에게**: 화이팅! J님은 친절하고 협조적이세요 ㅎㅎ  
**긴급 연락**: 막히면 J님께 바로 물어보세요. 빠르게 답해주십니다.

---

END OF HANDOFF DOCUMENT
